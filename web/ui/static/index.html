<!DOCTYPE html>
<!-- USE https://kangax.github.io/html-minifier/ to minimize HTML and https://www.toptal.com/developers/html-minifier to minify the JS-->

<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta name="description"
        content="PGTuner: The :project:`pgtuner` (or PostgreSQL: DBA & Tuner) is a SQL/Python-based project designed to manage and optimize kernel parameters and database settings, focusing on TCP networking (connection management, retries, timeouts, and **buffering**) and memory/VM management (swappiness, dirty ratios, over-commit memory, hugepages, and cache pressure); whilst maintaining high performance, stability, security, and concurrency for various system configurations. The tuning is inspired by many successful world-wide clusters (Notion, Cloudflare, ...) from OS part, and many DBA's experts at PostgreSQL community. This project is a combination of those experiences and designed to be a structured approach for various profiles and settings (easily customizable and extendable). " />
    <title>PGTuner - Automatic PostgreSQL Tuning Tool</title>
    <link href="resource/favicon.ico" rel="icon" />
    <!-- Bootstrap JS and Self-Hosted JavaScript -->
    <script crossorigin="anonymous" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!--    <script crossorigin="anonymous"-->
    <!--            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"-->
    <!--            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>-->

    <!-- Bootstrap CSS -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet" />
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">-->

    <!--    <link rel="stylesheet" href="/css/bootstrap.min.mincss3k.css">-->
    <link rel="stylesheet" href="css/bootstrap-icons.min.mincss3k.css" />
    <script src="js/pgtuner.js"></script>
    <!-- <script type="application/javascript" src="js/pgtuner.min.js"></script> -->
</head>

<!-- Include Bootstrap JS at the end of the body (ensure proper collapse and interactivity) -->
<header class="py-3" style="background: linear-gradient(to bottom, #f207b8, #f564e9)">
    <div class="container d-flex justify-content-between align-items-center">
        <!-- Logo and Tool Name -->
        <div class="d-flex align-items-center">
            <img alt="PGTuner Logo" class="me-2" src="resource/icon.min.png" width="60" height="60" />
            <div>
                <h1 class="h4 mb-0 text-white">PGTuner</h1>
                <small class="text-light">Extensive PostgreSQL optimization</small>
            </div>
        </div>

        <!-- Navigation Links and Toggle -->
        <nav class="d-flex align-items-center">
            <ul class="nav me-3">
                <li class="nav-item">
                    <a class="nav-link text-white fw-bold" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white fw-bold" href="https://github.com/your-repo-link" target="_blank">
                        <i class="bi bi-github mx-1"></i>
                        Contribute
                    </a>
                </li>
            </ul>
            <!-- Light/Dark Mode Toggle -->
            <!-- <button class="btn btn-light" id="theme-toggle">Light Mode</button> -->
        </nav>
    </div>
</header>

<body>
    <div class="container my-4">
        <h2 class="mb-4">PGTuner Input Form</h2>
        <div class="sections-container border border-red"></div>
        <script>
            const sections = [
                {
                    id: 'Workload and Optimization Mode',
                    label: 'Workload and Optimization Mode',
                    items: [
                        {
                            label: 'Workload Type',
                            id: 'workload_type',
                            description:
                                'Select the workload type for system tuning. The choice of workload type can impact some parameters, especially during the correction tuning and its associated risk level',
                            classes: '',
                            type: 'select',
                            items: [{ name: 'SOLTP: Single-User or Simple OLTP', value: 'soltp' }, { name: 'LOG: Logging or Log Data Ingestion', value: 'log' }, { name: 'TST: Time Series Data of OLTP or IoT', value: 'tst' }, { name: 'OLTP: Online Transaction Processing', value: 'oltp' }, { name: 'HTAP: Hybrid Transactional/Analytical Processing', value: 'htap', selected: true }, { name: 'TSH: Time-Series of Analytic and Transaction', value: 'tsh' }, { name: 'OLAP: Online Analytical Processing', value: 'olap' }, { name: 'TSA: Time-Series of OLAP', value: 'tsa' }, { name: 'DW: Data Warehouse', value: 'dw' }, { name: 'DL: Data Lake', value: 'dl' }, { name: 'Search: Full-Text Search and Indexing', value: 'search' }, { name: 'RAG: Retrieval-Augmented Generation', value: 'rag' }, { name: 'Geo: Geospatial Data', value: 'geo' }],
                        },
                        {
                            label: 'Memory Pool Optimization Mode',
                            id: 'opt_mem_pool',
                            description:
                                'If not NONE, it would proceed the extra tuning to increase the memory usage to reach to your expectation (shared_buffers, work_mem, temp_buffer, wal_buffer, ...). Set to SPIDEY use the worst case of memory usage by assuming all connections are under high load. Set to OPTIMUS_PRIME (default) take the average between normal (active connections) and worst case as the stopping condition; PRIMORDIAL take the normal case as the stopping condition.',
                            classes: '',
                            type: 'select',
                            items: [{ name: 'NONE: Ignore Optimization', value: 'none' }, { name: 'SPIDEY: Light-weight Optimization', value: 'lightweight' }, { name: 'OPTIMUS PRIME: General Optimization', value: 'general', selected: true }, { name: 'PRIMORDIAL: Extreme Optimization', value: 'aggressive' }],
                        },
                        {
                            label: 'Operating System',
                            id: 'operating_system',
                            description:
                                'The operating system that the PostgreSQL server is running on. Default is Linux. If the memory usage of kernel and monitoring is set to -1, the system would self-calculate your basic RAM usage based on the developer testing. To minimize its estimation, set the memory usage of kernel and monitoring to 0 bytes',
                            classes: '',
                            type: 'select',
                            items: [{ name: 'Linux', value: 'linux', selected: true }, { name: 'Windows', value: 'windows' }, { name: 'Container (K8s, Docker, containerd)', value: 'containerd' }, { name: 'PaaS (Cloud or 3rd-Party)', value: 'PaaS' }],
                        },
                        {
                            label: 'Number of vCPUs',
                            id: 'logical_cpu',
                            description:
                                'Select the number of logical CPUs for system tuning. This can bond together with the CPU profile',
                            classes: '',
                            type: 'range',
                            items: [
                                { min: 1, max: 128, step: 1, value: 4, id: 'logical_cpu_range', placeholder: 'Enter the number of logical CPUs', onChange: () => syncSliderToNumber('logical_cpu'), classes: 'form-range me-3', name: 'logical_cpu' }, 
                                { min: 1, max: 128, step: 1, value: 4, id: 'logical_cpu', placeholder: 'Enter the number of logical CPUs', onChange: () => { console.log('here'); syncNumberToSlider('logical_cpu') }, classes: 'form-control w-25', name: 'logical_cpu' }],
                        },
                        {
                            label: 'RAM Size (GiB)',
                            id: 'ram_sample_in_gib',
                            description:
                                'Select the RAM size for system tuning. This can bond together with the Memory profile. However, please ensure that the RAM must be larger than total RAM in use. For the PostgreSQL database the minimum memory should be larger than 4 GiB (recommended to be larger than 8 GiB).',
                            classes: '',
                            type: 'range',
                            items: [{ min: 2, max: 1024, step: 0.25, value: 16, id: 'ram_sample_in_gib_range', placeholder: 'Enter the RAM size', onChange: () => { syncSliderToNumber('ram_sample_in_gib'); ram_calculator(); }, classes: 'form-range me-3', name: 'ram_sample_in_gib' }, { min: 2, max: 1024, step: 0.25, value: 16, id: 'ram_sample_in_gib', placeholder: 'Enter the RAM size', onChange: () => { syncNumberToSlider('ram_sample_in_gib'); ram_calculator(); }, classes: 'form-control w-50', name: 'ram_sample_in_gib' }],
                        },
                        {
                            label: 'Add System Reserved Memory into RAM',
                            id: 'add_system_reserved_memory_into_ram',
                            description:
                                'Add system reserved memory into RAM. Only enable this if you take the value *directly* the operating system by measurement (free -m on Linux, Task Manager on Windows, etc), as this would add a small amount of memory into the estimation depending on the operating system. However, we do not recommend to set this as it could assume your PostgreSQL can use the reserved memory which are already dedicated for the kernel, booting process, and other system processes.',
                            classes: 'form-check form-switch',
                            type: 'switch',
                            items: [{ onChange: () => ram_calculator(), id: 'add_system_reserved_memory_into_ram', label: ['Yes', 'No'], value: false }],
                        },
                        {
                            label: 'Kernel Memory Usage (MiB)',
                            id: 'base_kernel_memory_usage_in_mib',
                            description:
                                'Enter the kernel memory when idle in MiB. Default value is -1 would make pgtuner to perform estimation based on the OS. Set to 0 to disable. If you have measured the kernel memory then set to the value you have measured. But ensure that the RAM capacity must be larger than this kernel and monitoring memory usage.',
                            classes: '',
                            type: 'range',
                            items: [{ min: -1, max: 8192, step: 1, value: -1, id: 'base_kernel_memory_usage_in_mib_range', placeholder: 'Enter the kernel memory usage', onChange: () => { syncSliderToNumber('base_kernel_memory_usage_in_mib'); ram_calculator(); }, classes: 'form-range me-3', name: 'base_kernel_memory_usage_in_mib' }, { min: -1, max: 8192, step: 1, value: -1, id: 'base_kernel_memory_usage_in_mib', placeholder: 'Enter the kernel memory usage', onChange: () => { syncNumberToSlider('base_kernel_memory_usage_in_mib'); ram_calculator(); }, classes: 'form-control w-50', name: 'base_kernel_memory_usage_in_mib' }],
                        },
                        {
                            label: 'Monitoring Memory Usage (MiB)',
                            id: 'base_monitoring_memory_usage_in_mib',
                            description:
                                'Enter the monitoring memory when idle in MiB. Default value is -1 would make pgtuner to perform estimation based on the OS. Set to 0 to disable. If you have measured the monitoring memory then set to the value you have measured. But ensure that the RAM capacity must be larger than this kernel and monitoring memory usage.',
                            classes: '',
                            type: 'range',
                            items: [{ min: -1, max: 4096, step: 1, value: -1, id: 'base_monitoring_memory_usage_in_mib_range', placeholder: 'Enter the monitoring memory usage', onChange: () => { syncSliderToNumber('base_monitoring_memory_usage_in_mib'); ram_calculator(); }, classes: 'form-range me-3', name: 'base_monitoring_memory_usage_in_mib' }, { min: -1, max: 4096, step: 1, value: -1, id: 'base_monitoring_memory_usage_in_mib', placeholder: 'Enter the monitoring memory usage', onChange: () => { syncNumberToSlider('base_monitoring_memory_usage_in_mib'); ram_calculator(); }, classes: 'form-control w-50', name: 'base_monitoring_memory_usage_in_mib' }],
                        },
                        {
                            label: 'Total Usable RAM (MiB)',
                            id: 'total_usable_ram',
                            description:
                                'This displays the total usable RAM in MiB after accounting for kernel and monitoring memory usage. We recommended to have this attribute at least 1.5 GiB. Recommended minimally at 4-8 GiB at least.',
                            classes: '',
                            type: 'text',
                            items: [{ onChange: () => { syncNumberToSlider('base_monitoring_memory_usage_in_mib'); ram_calculator(); }, value: '???', disabled: true, readonly: true, id: 'total_usable_ram' }],
                        },
                    ],
                },
            ];

            const renderSections = () => {
                const parent = document.querySelector('.sections-container');
                sections.forEach((section) => {
                    const sectionElement = document.createElement('div');
                    sectionElement.classList.add('my-4');
                    const sectionTitle = document.createElement('h4');
                    sectionTitle.classList.add('mb-3');
                    sectionTitle.textContent = section.label;
                    sectionElement.appendChild(sectionTitle);
                    const rowElement = document.createElement('div');
                    rowElement.classList.add('row');
                    section.items.forEach((item) => {
                        const colElement = document.createElement('div');
                        colElement.classList.add('col-4', 'mb-3');

                        // label
                        const dFlexElement = document.createElement('div');
                        dFlexElement.classList.add('d-flex', 'justify-content-between', 'align-items-center');
                        const labelElement = document.createElement('label');
                        labelElement.classList.add('form-label');
                        labelElement.setAttribute('for', item.id);
                        labelElement.textContent = item.label;
                        const infoElement = document.createElement('i');
                        infoElement.classList.add('bi', 'bi-info-circle', 'text-primary', 'align-items-left');
                        infoElement.setAttribute('data-bs-toggle', 'popover');
                        infoElement.setAttribute('data-bs-trigger', 'hover focus');
                        infoElement.setAttribute('role', 'button');
                        infoElement.setAttribute('tabindex', '0');
                        infoElement.setAttribute('data-bs-placement', 'auto');
                        infoElement.setAttribute('data-bs-content', item.description);
                        infoElement.setAttribute('title', item.label);
                        dFlexElement.appendChild(labelElement);
                        dFlexElement.appendChild(infoElement);
                        colElement.appendChild(dFlexElement);
                        
                        // input
                        const dFlexElement2 = document.createElement('div');
                        dFlexElement2.classList.add('d-flex', 'align-items-center');
                        if (item.type === 'select') {
                            const selectElement = document.createElement('select');
                            selectElement.classList.add('form-select');
                            selectElement.setAttribute('id', item.id);
                            selectElement.setAttribute('name', item.id);
                            item.items.forEach((option) => {
                                const optionElement = document.createElement('option');
                                optionElement.setAttribute('value', option.value);
                                optionElement.textContent = option.name;
                                if (option.selected) {
                                    optionElement.setAttribute('selected', true);
                                }
                                selectElement.appendChild(optionElement);
                            });
                            dFlexElement2.appendChild(selectElement);
                        } else if (item.type === 'range') {
                            const rangeElement = document.createElement('input');
                            rangeElement.classList.add(...item.items[0].classes.split(' '));
                            rangeElement.setAttribute('type', 'range');
                            rangeElement.setAttribute('min', item.items[0].min);
                            rangeElement.setAttribute('max', item.items[0].max);
                            rangeElement.setAttribute('step', item.items[0].step);
                            rangeElement.setAttribute('value', item.items[0].value);
                            rangeElement.setAttribute('id', item.items[0].id);
                            rangeElement.setAttribute('name', item.items[0].name);
                            rangeElement.setAttribute('placeholder', item.items[0].placeholder);
                            rangeElement.onchange = item.items[0].onChange;
                            dFlexElement2.appendChild(rangeElement);

                            const numberElement = document.createElement('input');
                            numberElement.classList.add(...item.items[1].classes.split(' '));
                            numberElement.setAttribute('type', 'number');
                            numberElement.setAttribute('min', item.items[1].min);
                            numberElement.setAttribute('max', item.items[1].max);
                            numberElement.setAttribute('step', item.items[1].step);
                            numberElement.setAttribute('value', item.items[1].value);
                            numberElement.setAttribute('id', item.items[1].id);
                            numberElement.setAttribute('name', item.items[1].name);
                            numberElement.setAttribute('placeholder', item.items[1].placeholder);
                            numberElement.onchange = item.items[1].onChange;
                            dFlexElement2.appendChild(numberElement);
                        } else if (item.type === 'switch') {
                            item.items.forEach((switchItem) => {
                                const switchElement = document.createElement('input');
                                if(switchItem?.classes?.length) {
                                    switchElement.classList.add(...switchItem?.classes?.split(' '));
                                }
                                switchElement.setAttribute('type', 'checkbox');
                                switchElement.setAttribute('role', 'switch');
                                switchElement.setAttribute('id', switchItem.id);
                                switchElement.onchange=switchItem.onChange;
                                colElement.appendChild(switchElement);
                                const labelElement = document.createElement('label');
                                labelElement.classList.add('form-check-label', 'px-3');
                                labelElement.setAttribute('for', switchItem.id);
                                labelElement.textContent = switchItem.value ? switchItem.label[0] : switchItem.label[1];
                                dFlexElement2.appendChild(labelElement);
                            })
                        } else if (item.type === 'text') {
                            item.items.forEach((textItem) => {
                                const textElement = document.createElement('input');
                                if(textItem.classes?.length) {
                                    textElement.classList.add(...textItem.classes.split(' '));
                                }
                                textElement.setAttribute('type', 'text');
                                textElement.setAttribute('value', textItem.value);
                                textElement.setAttribute('id', textItem.id);
                                textElement.setAttribute('disabled', textItem.disabled);
                                textElement.setAttribute('readonly', textItem.readonly);
                                textElement.onchange = textItem.onChange;
                                dFlexElement2.appendChild(textElement);
                            })
                        }
                        colElement.appendChild(dFlexElement2);
                        rowElement.appendChild(colElement);
                    });
                    sectionElement.appendChild(rowElement);
                    parent.appendChild(sectionElement);
                })
            }

            renderSections();
        </script>
    </div>
</body>
</html>